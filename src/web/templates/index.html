{% extends "base.html" %}

{% block title %}首頁 - 考古題處理系統{% endblock %}

{% block content %}
<div class="hero">
    <h1>🎯 歡迎使用考古題處理系統 v2.0</h1>
    <p class="subtitle">智能爬蟲下載 | OCR深度整合 | 自動題目解析 | Google表單生成</p>
</div>

<div class="features-grid">
    <div class="feature-card" style="border-left: 4px solid #4CAF50;">
        <div class="feature-icon">🕷️</div>
        <h3>爬蟲下載</h3>
        <p>自動下載考選部考古題，支持並發下載、斷點續傳、進度顯示</p>
        <a href="{{ url_for('crawler_page') }}" class="btn btn-primary">開始下載</a>
    </div>

    <div class="feature-card" style="border-left: 4px solid #2196F3;">
        <div class="feature-icon">🔍</div>
        <h3>OCR 深度整合</h3>
        <p>智能檢測PDF類型，自動優化OCR參數，質量驗證，混合模式處理</p>
        <a href="{{ url_for('ocr_page') }}" class="btn btn-primary">OCR 處理</a>
    </div>

    <div class="feature-card" style="border-left: 4px solid #FF9800;">
        <div class="feature-icon">📄</div>
        <h3>PDF 題目解析</h3>
        <p>上傳考古題PDF，自動解析題目和選項，生成CSV和Google表單</p>
        <a href="{{ url_for('upload_page') }}" class="btn btn-primary">開始處理</a>
    </div>

    <div class="feature-card" style="border-left: 4px solid #9C27B0;">
        <div class="feature-icon">⏱️</div>
        <h3>性能監控</h3>
        <p>實時監控處理性能，查看記憶體和CPU使用情況</p>
        <a href="{{ url_for('monitor_page') }}" class="btn btn-secondary">查看監控</a>
    </div>
</div>

<div class="stats-section">
    <h2>系統統計</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value" id="total-tasks">0</div>
            <div class="stat-label">總處理任務</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="completed-tasks">0</div>
            <div class="stat-label">已完成任務</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="total-questions">0</div>
            <div class="stat-label">解析題目數</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">4</div>
            <div class="stat-label">支持語言</div>
        </div>
    </div>
</div>

<div class="features-list">
    <h2>主要功能</h2>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div>
            <h3 style="color: #4CAF50; margin-bottom: 12px;">🕷️ 爬蟲下載功能</h3>
            <ul>
                <li>✅ 自動下載考選部考古題（民國81-114年）</li>
                <li>✅ 並發下載（3-5倍速度提升）</li>
                <li>✅ 進度實時顯示（tqdm支持）</li>
                <li>✅ 斷點續傳（HTTP Range支持）</li>
                <li>✅ 智能重試機制（10次重試）</li>
                <li>✅ PDF文件完整性驗證</li>
            </ul>
        </div>
        <div>
            <h3 style="color: #2196F3; margin-bottom: 12px;">🔍 OCR 深度整合</h3>
            <ul>
                <li>✅ 自動PDF類型檢測（文字/掃描/混合）</li>
                <li>✅ 智能參數調優（DPI 150-400自適應）</li>
                <li>✅ OCR質量驗證（多維度評分）</li>
                <li>✅ 混合模式處理（逐頁智能判斷）</li>
                <li>✅ 性能優化（文字型10倍速）</li>
                <li>✅ 質量閾值配置（優秀/良好/一般）</li>
            </ul>
        </div>
        <div>
            <h3 style="color: #FF9800; margin-bottom: 12px;">📄 PDF 題目解析</h3>
            <ul>
                <li>✅ 智能PDF文字提取</li>
                <li>✅ 多種題型支持（選擇題、申論題、填空題等）</li>
                <li>✅ 自動生成Google表單腳本</li>
                <li>✅ 並發批量處理</li>
                <li>✅ 流式處理（10倍記憶體降低）</li>
                <li>✅ 自動重試和錯誤恢復</li>
            </ul>
        </div>
        <div>
            <h3 style="color: #9C27B0; margin-bottom: 12px;">⚡ 系統增強</h3>
            <ul>
                <li>✅ Web UI 控制台</li>
                <li>✅ 實時進度和日誌顯示</li>
                <li>✅ 完整的性能監控</li>
                <li>✅ 多語言界面支持</li>
                <li>✅ RESTful API 接口</li>
                <li>✅ 任務管理和追蹤</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 載入統計數據
async function loadStats() {
    try {
        const response = await secureFetch('/api/tasks');
        const tasks = await response.json();

        const totalTasks = tasks.length;
        const completedTasks = tasks.filter(t => t.status === 'completed').length;
        const totalQuestions = tasks
            .filter(t => t.status === 'completed')
            .reduce((sum, t) => sum + (t.result?.question_count || 0), 0);

        document.getElementById('total-tasks').textContent = totalTasks;
        document.getElementById('completed-tasks').textContent = completedTasks;
        document.getElementById('total-questions').textContent = totalQuestions;
    } catch (error) {
        console.error('載入統計失敗:', error);
    }
}

// 頁面載入時執行
loadStats();

// 每30秒更新一次
setInterval(loadStats, 30000);
</script>
{% endblock %}
