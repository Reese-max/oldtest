# ç€è¦½å™¨è‡ªå‹•åŒ–æ¸¬è©¦æŒ‡å—

## ğŸ“‹ ç›®éŒ„

- [ç°¡ä»‹](#ç°¡ä»‹)
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
- [å®‰è£æ­¥é©Ÿ](#å®‰è£æ­¥é©Ÿ)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [æ¸¬è©¦èªªæ˜](#æ¸¬è©¦èªªæ˜)
- [é«˜ç´šé…ç½®](#é«˜ç´šé…ç½®)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ç°¡ä»‹

æœ¬é …ç›®æä¾›å®Œæ•´çš„ç€è¦½å™¨è‡ªå‹•åŒ–æ¸¬è©¦æ–¹æ¡ˆï¼Œä½¿ç”¨ **Playwright** æ¡†æ¶æ¨¡æ“¬çœŸå¯¦ç”¨æˆ¶æ“ä½œï¼Œè‡ªå‹•æ¸¬è©¦è€ƒå¤é¡Œè™•ç†ç³»çµ±çš„æ‰€æœ‰å‰ç«¯åŠŸèƒ½ã€‚

### ç‚ºä»€éº¼é¸æ“‡ Playwrightï¼Ÿ

- âœ… **ç¾ä»£åŒ–**ï¼šæ”¯æŒæœ€æ–°çš„ Web æ¨™æº–
- âœ… **å¤šç€è¦½å™¨**ï¼šæ”¯æŒ Chromiumã€Firefoxã€WebKit
- âœ… **å¿«é€Ÿç©©å®š**ï¼šè‡ªå‹•ç­‰å¾…æ©Ÿåˆ¶ï¼Œæ¸›å°‘ä¸ç©©å®šæ¸¬è©¦
- âœ… **å¼·å¤§åŠŸèƒ½**ï¼šæˆªåœ–ã€éŒ„å½±ã€ç¶²çµ¡æ””æˆªç­‰
- âœ… **é–‹ç™¼è€…å‹å¥½**ï¼šè±å¯Œçš„ API å’Œå„ªç§€çš„æ–‡æª”

---

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ¸¬è©¦è¦†è“‹

æœ¬æ¸¬è©¦å¥—ä»¶è¦†è“‹ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **é¦–é æ¸¬è©¦** âœ…
   - é é¢å…ƒç´ æª¢æŸ¥
   - å°èˆªé€£çµé©—è­‰
   - çµ±è¨ˆæ•¸æ“šé¡¯ç¤º

2. **çˆ¬èŸ²ä¸‹è¼‰é é¢** âœ…
   - è¡¨å–®å…ƒç´ æª¢æŸ¥
   - å¹´ä»½å’Œè€ƒè©¦é¡å‹é¸æ“‡
   - ä¸‹è¼‰æŒ‰éˆ•åŠŸèƒ½

3. **OCR è™•ç†é é¢** âœ…
   - æ–‡ä»¶ä¸Šå‚³æ§ä»¶
   - OCR åƒæ•¸é¸é …
   - è™•ç†åŠŸèƒ½é©—è­‰

4. **PDF ä¸Šå‚³é é¢** âœ…
   - æ–‡ä»¶ä¸Šå‚³åŠŸèƒ½
   - è™•ç†é¸é …è¨­ç½®
   - çµæœé¡¯ç¤º

5. **æ€§èƒ½ç›£æ§é é¢** âœ…
   - å¯¦æ™‚æ•¸æ“šé¡¯ç¤º
   - åœ–è¡¨æ¸²æŸ“
   - æ•¸æ“šæ›´æ–°

6. **é é¢å°èˆª** âœ…
   - è·¨é é¢å°èˆª
   - URL é©—è­‰
   - ç‹€æ…‹ä¿æŒ

7. **éŸ¿æ‡‰å¼è¨­è¨ˆ** âœ…
   - Desktop (1920x1080)
   - Tablet (768x1024)
   - Mobile (375x667)

8. **API å¥åº·æª¢æŸ¥** âœ…
   - ç«¯é»å¯ç”¨æ€§
   - éŸ¿æ‡‰ç‹€æ…‹é©—è­‰

### ğŸ¨ æ¸¬è©¦ç‰¹æ€§

- **è‡ªå‹•æˆªåœ–**ï¼šæ¯å€‹æ¸¬è©¦æ­¥é©Ÿè‡ªå‹•æˆªåœ–ï¼Œä¿å­˜åˆ° `tests/browser/screenshots/`
- **è©³ç´°æ—¥èªŒ**ï¼šå¯¦æ™‚é¡¯ç¤ºæ¸¬è©¦é€²åº¦å’Œçµæœ
- **JSON å ±å‘Š**ï¼šç”Ÿæˆ JSON æ ¼å¼çš„æ¸¬è©¦å ±å‘Š
- **å¯è¦–åŒ–æ¨¡å¼**ï¼šå¯é¸æ“‡é¡¯ç¤ºç€è¦½å™¨çª—å£ï¼Œè§€å¯Ÿæ¸¬è©¦éç¨‹
- **å¤šç€è¦½å™¨**ï¼šæ”¯æŒ Chromiumã€Firefoxã€WebKit
- **éˆæ´»é…ç½®**ï¼šå¯è‡ªå®šç¾© URLã€å»¶é²ã€è¶…æ™‚ç­‰åƒæ•¸

---

## å¿«é€Ÿé–‹å§‹

### ä¸€éµé‹è¡Œï¼ˆæ¨è–¦ï¼‰

```bash
# å®‰è£ä¾è³´
pip install -r requirements-browser-test.txt
playwright install chromium

# é‹è¡Œæ¸¬è©¦ï¼ˆè‡ªå‹•å•Ÿå‹•æœå‹™å™¨ï¼‰
python run_browser_test.py
```

å°±é€™éº¼ç°¡å–®ï¼è…³æœ¬æœƒï¼š
1. è‡ªå‹•å•Ÿå‹• Web æœå‹™å™¨
2. é‹è¡Œæ‰€æœ‰ç€è¦½å™¨æ¸¬è©¦
3. ç”Ÿæˆæ¸¬è©¦å ±å‘Šå’Œæˆªåœ–
4. è‡ªå‹•æ¸…ç†å’Œé—œé–‰æœå‹™å™¨

---

## å®‰è£æ­¥é©Ÿ

### 1. å®‰è£ Python ä¾è³´

```bash
# å®‰è£ç€è¦½å™¨æ¸¬è©¦ä¾è³´
pip install -r requirements-browser-test.txt
```

### 2. å®‰è£ç€è¦½å™¨

```bash
# å®‰è£ Chromiumï¼ˆæ¨è–¦ï¼‰
playwright install chromium

# æˆ–å®‰è£æ‰€æœ‰ç€è¦½å™¨
playwright install
```

### 3. é©—è­‰å®‰è£

```bash
# é©—è­‰ Playwright å®‰è£
playwright --version
```

---

## ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: ä½¿ç”¨å¿«é€Ÿå•Ÿå‹•è…³æœ¬ï¼ˆæ¨è–¦ï¼‰

```bash
# é»˜èªæ¨¡å¼ï¼ˆé¡¯ç¤ºç€è¦½å™¨ï¼Œæ…¢é€Ÿæ“ä½œï¼‰
python run_browser_test.py

# ç„¡é ­æ¨¡å¼ï¼ˆä¸é¡¯ç¤ºç€è¦½å™¨ï¼Œé©åˆ CI/CDï¼‰
python run_browser_test.py --headless

# å¿«é€Ÿæ¨¡å¼ï¼ˆä¸å»¶é²æ“ä½œï¼‰
python run_browser_test.py --fast

# ä½¿ç”¨ Firefox
python run_browser_test.py --browser firefox

# è‡ªå®šç¾©ç«¯å£
python run_browser_test.py --port 8080

# åƒ…å•Ÿå‹•æœå‹™å™¨ï¼ˆç”¨æ–¼æ‰‹å‹•æ¸¬è©¦ï¼‰
python run_browser_test.py --server-only
```

### æ–¹æ³• 2: æ‰‹å‹•é‹è¡Œ

```bash
# çµ‚ç«¯ 1: å•Ÿå‹• Web æœå‹™å™¨
python run_webui.py

# çµ‚ç«¯ 2: é‹è¡Œæ¸¬è©¦
python tests/browser/test_browser_automation.py
```

### æ–¹æ³• 3: ç›´æ¥é‹è¡Œæ¸¬è©¦è…³æœ¬

```bash
# åŸºæœ¬ç”¨æ³•
python tests/browser/test_browser_automation.py

# è‡ªå®šç¾© URL
python tests/browser/test_browser_automation.py --url http://localhost:8080

# ä½¿ç”¨ Firefox ç„¡é ­æ¨¡å¼
python tests/browser/test_browser_automation.py --browser firefox --headless

# å¿«é€Ÿæ¨¡å¼
python tests/browser/test_browser_automation.py --fast
```

---

## æ¸¬è©¦èªªæ˜

### æ¸¬è©¦æµç¨‹

æ¸¬è©¦è…³æœ¬æœƒæŒ‰ä»¥ä¸‹é †åºåŸ·è¡Œï¼š

```
1. å•Ÿå‹•ç€è¦½å™¨
2. æ¸¬è©¦é¦–é 
3. æ¸¬è©¦çˆ¬èŸ²ä¸‹è¼‰é é¢
4. æ¸¬è©¦ OCR è™•ç†é é¢
5. æ¸¬è©¦ PDF ä¸Šå‚³é é¢
6. æ¸¬è©¦æ€§èƒ½ç›£æ§é é¢
7. æ¸¬è©¦é é¢å°èˆª
8. æ¸¬è©¦éŸ¿æ‡‰å¼è¨­è¨ˆ
9. æ¸¬è©¦ API å¥åº·æª¢æŸ¥
10. ç”Ÿæˆæ¸¬è©¦å ±å‘Š
11. é—œé–‰ç€è¦½å™¨
```

### æ¸¬è©¦è¼¸å‡º

#### 1. æ§åˆ¶å°è¼¸å‡º

```
======================================================================
                        ç€è¦½å™¨è‡ªå‹•åŒ–æ¸¬è©¦
======================================================================

ğŸŒ æ¸¬è©¦ URL: http://127.0.0.1:5000
ğŸ–¥ï¸  ç€è¦½å™¨: chromium
ğŸ‘ï¸  å¯è¦‹æ¨¡å¼: æ˜¯
â±ï¸  æ“ä½œå»¶é²: 500ms
ğŸ“¸ æˆªåœ–ç›®éŒ„: /path/to/tests/browser/screenshots

======================================================================
æ¸¬è©¦ 1: é¦–é åŠŸèƒ½
======================================================================

ğŸ“ è¨ªå•é¦–é ...
   é é¢æ¨™é¡Œ: é¦–é  - è€ƒå¤é¡Œè™•ç†ç³»çµ±

ğŸ” æª¢æŸ¥é é¢å…ƒç´ ...
   ä¸»æ¨™é¡Œ: æ­¡è¿ä½¿ç”¨è€ƒå¤é¡Œè™•ç†ç³»çµ± v2.0
   åŠŸèƒ½å¡ç‰‡æ•¸é‡: 4

âœ… é¦–é æ¸¬è©¦: PASS
...
```

#### 2. æˆªåœ–æ–‡ä»¶

æ¸¬è©¦éç¨‹ä¸­æœƒè‡ªå‹•æˆªåœ–ï¼Œä¿å­˜åˆ°ï¼š

```
tests/browser/screenshots/
â”œâ”€â”€ 01_homepage.png
â”œâ”€â”€ 02_crawler_page.png
â”œâ”€â”€ 02_crawler_filled.png
â”œâ”€â”€ 03_ocr_page.png
â”œâ”€â”€ 04_upload_page.png
â”œâ”€â”€ 05_monitor_page.png
â”œâ”€â”€ 06_nav_1_çˆ¬èŸ²ä¸‹è¼‰.png
â”œâ”€â”€ 06_nav_2_OCR.png
â”œâ”€â”€ 06_nav_3_ä¸Šå‚³.png
â”œâ”€â”€ 06_nav_4_ç›£æ§.png
â”œâ”€â”€ 07_responsive_Desktop.png
â”œâ”€â”€ 07_responsive_Tablet.png
â”œâ”€â”€ 07_responsive_Mobile.png
â””â”€â”€ 08_health_check.png
```

#### 3. JSON æ¸¬è©¦å ±å‘Š

```json
[
  {
    "test": "é¦–é æ¸¬è©¦",
    "status": "PASS",
    "message": "æ‰€æœ‰å…ƒç´ æ­£å¸¸é¡¯ç¤º",
    "timestamp": 1699999999.123
  },
  {
    "test": "çˆ¬èŸ²é é¢æ¸¬è©¦",
    "status": "PASS",
    "message": "è¡¨å–®å…ƒç´ å®Œæ•´",
    "timestamp": 1699999999.456
  }
]
```

ä¿å­˜ä½ç½®: `tests/browser/test_results.json`

---

## é«˜ç´šé…ç½®

### è‡ªå®šç¾©æ¸¬è©¦é…ç½®

ç·¨è¼¯ `tests/browser/test_browser_automation.py`ï¼Œä¿®æ”¹ `BrowserTestConfig` é¡ï¼š

```python
config = BrowserTestConfig(
    base_url="http://127.0.0.1:5000",  # æ¸¬è©¦ URL
    headless=False,                     # æ˜¯å¦ç„¡é ­æ¨¡å¼
    slow_mo=500,                        # æ“ä½œå»¶é²ï¼ˆmsï¼‰
    timeout=30000,                      # è¶…æ™‚æ™‚é–“ï¼ˆmsï¼‰
    browser_type="chromium"             # ç€è¦½å™¨é¡å‹
)
```

### æ·»åŠ è‡ªå®šç¾©æ¸¬è©¦

åœ¨ `BrowserAutomationTester` é¡ä¸­æ·»åŠ æ–°çš„æ¸¬è©¦æ–¹æ³•ï¼š

```python
async def test_custom_feature(self):
    """æ¸¬è©¦è‡ªå®šç¾©åŠŸèƒ½"""
    try:
        # è¨ªå•é é¢
        await self.page.goto(f"{self.config.base_url}/custom")

        # åŸ·è¡Œæ“ä½œ
        button = self.page.locator("button.custom")
        await button.click()

        # é©—è­‰çµæœ
        result = await self.page.locator(".result").text_content()
        assert "æˆåŠŸ" in result

        # æˆªåœ–
        await self.screenshot("custom_feature")

        # è¨˜éŒ„çµæœ
        self.log_result("è‡ªå®šç¾©åŠŸèƒ½æ¸¬è©¦", "PASS")

    except Exception as e:
        self.log_result("è‡ªå®šç¾©åŠŸèƒ½æ¸¬è©¦", "FAIL", str(e))
        raise
```

ç„¶å¾Œåœ¨ `run_all_tests()` ä¸­èª¿ç”¨ï¼š

```python
async def run_all_tests(self):
    await self.setup()

    # ç¾æœ‰æ¸¬è©¦
    await self.test_homepage()
    # ...

    # æ·»åŠ æ–°æ¸¬è©¦
    await self.test_custom_feature()

    self.print_summary()
    await self.teardown()
```

### é…ç½®ä¸åŒçš„ç€è¦½å™¨

```python
# Chromiumï¼ˆChrome/Edgeï¼‰
config = BrowserTestConfig(browser_type="chromium")

# Firefox
config = BrowserTestConfig(browser_type="firefox")

# WebKitï¼ˆSafariï¼‰
config = BrowserTestConfig(browser_type="webkit")
```

---

## æ•…éšœæ’é™¤

### å•é¡Œ 1: ç€è¦½å™¨æœªå®‰è£

**éŒ¯èª¤è¨Šæ¯**:
```
playwright._impl._api_types.Error: Executable doesn't exist
```

**è§£æ±ºæ–¹æ³•**:
```bash
playwright install chromium
```

### å•é¡Œ 2: Web æœå‹™å™¨æœªå•Ÿå‹•

**éŒ¯èª¤è¨Šæ¯**:
```
playwright._impl._api_types.Error: net::ERR_CONNECTION_REFUSED
```

**è§£æ±ºæ–¹æ³•**:
```bash
# å…ˆå•Ÿå‹• Web æœå‹™å™¨
python run_webui.py

# ç„¶å¾Œåœ¨å¦ä¸€å€‹çµ‚ç«¯é‹è¡Œæ¸¬è©¦
python tests/browser/test_browser_automation.py --test-only
```

### å•é¡Œ 3: ç«¯å£è¢«å ç”¨

**éŒ¯èª¤è¨Šæ¯**:
```
OSError: [Errno 48] Address already in use
```

**è§£æ±ºæ–¹æ³•**:
```bash
# ä½¿ç”¨ä¸åŒçš„ç«¯å£
python run_browser_test.py --port 8080
```

æˆ–æŸ¥æ‰¾ä¸¦é—œé–‰å ç”¨ç«¯å£çš„é€²ç¨‹ï¼š

```bash
# Linux/Mac
lsof -i :5000
kill -9 <PID>

# Windows
netstat -ano | findstr :5000
taskkill /PID <PID> /F
```

### å•é¡Œ 4: æ¸¬è©¦è¶…æ™‚

**éŒ¯èª¤è¨Šæ¯**:
```
TimeoutError: Timeout 30000ms exceeded
```

**è§£æ±ºæ–¹æ³•**:

èª¿æ•´è¶…æ™‚æ™‚é–“ï¼š

```python
config = BrowserTestConfig(timeout=60000)  # 60ç§’
```

æˆ–åœ¨æ¸¬è©¦ä¸­å¢åŠ ç­‰å¾…æ™‚é–“ï¼š

```python
await self.page.wait_for_timeout(5000)  # ç­‰å¾… 5 ç§’
```

### å•é¡Œ 5: æˆªåœ–å¤±æ•—

**è§£æ±ºæ–¹æ³•**:

ç¢ºä¿æˆªåœ–ç›®éŒ„å­˜åœ¨ï¼š

```bash
mkdir -p tests/browser/screenshots
```

### å•é¡Œ 6: æ¬Šé™å•é¡Œ

**éŒ¯èª¤è¨Šæ¯**:
```
PermissionError: [Errno 13] Permission denied
```

**è§£æ±ºæ–¹æ³•**:

```bash
# çµ¦è…³æœ¬æ·»åŠ åŸ·è¡Œæ¬Šé™
chmod +x run_browser_test.py
chmod +x tests/browser/test_browser_automation.py
```

---

## CI/CD é›†æˆ

### GitHub Actions

å‰µå»º `.github/workflows/browser-test.yml`:

```yaml
name: Browser Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install -r requirements-browser-test.txt

    - name: Install Playwright browsers
      run: playwright install chromium

    - name: Run browser tests
      run: python run_browser_test.py --headless --fast

    - name: Upload screenshots
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: test-screenshots
        path: tests/browser/screenshots/

    - name: Upload test results
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: test-results
        path: tests/browser/test_results.json
```

### GitLab CI

å‰µå»º `.gitlab-ci.yml`:

```yaml
browser_tests:
  image: mcr.microsoft.com/playwright/python:v1.40.0
  script:
    - pip install -r requirements.txt
    - pip install -r requirements-browser-test.txt
    - python run_browser_test.py --headless --fast
  artifacts:
    when: always
    paths:
      - tests/browser/screenshots/
      - tests/browser/test_results.json
```

---

## æœ€ä½³å¯¦è¸

### 1. æ¸¬è©¦å‰æº–å‚™

- âœ… ç¢ºä¿æ‰€æœ‰ä¾è³´å·²å®‰è£
- âœ… æª¢æŸ¥ç«¯å£æ˜¯å¦å¯ç”¨
- âœ… æ¸…ç†èˆŠçš„æ¸¬è©¦æ•¸æ“š

### 2. ç·¨å¯«æ¸¬è©¦

- âœ… ä½¿ç”¨æœ‰æ„ç¾©çš„æ¸¬è©¦åç¨±
- âœ… æ¯å€‹æ¸¬è©¦æ‡‰è©²ç¨ç«‹
- âœ… æ·»åŠ é©ç•¶çš„ç­‰å¾…æ™‚é–“
- âœ… ä½¿ç”¨æ˜ç¢ºçš„æ–·è¨€
- âœ… æˆªåœ–ä¿å­˜é‡è¦æ­¥é©Ÿ

### 3. éŒ¯èª¤è™•ç†

- âœ… ä½¿ç”¨ try-except æ•ç²ç•°å¸¸
- âœ… å¤±æ•—æ™‚æˆªåœ–
- âœ… è¨˜éŒ„è©³ç´°çš„éŒ¯èª¤ä¿¡æ¯

### 4. æ€§èƒ½å„ªåŒ–

- âœ… ä½¿ç”¨ç„¡é ­æ¨¡å¼ï¼ˆCI/CDï¼‰
- âœ… åˆç†è¨­ç½®è¶…æ™‚æ™‚é–“
- âœ… é¿å…ä¸å¿…è¦çš„ç­‰å¾…
- âœ… ä¸¦è¡Œé‹è¡Œæ¸¬è©¦ï¼ˆé«˜ç´šï¼‰

---

## ç›¸é—œè³‡æº

- [Playwright å®˜æ–¹æ–‡æª”](https://playwright.dev/python/)
- [Playwright API åƒè€ƒ](https://playwright.dev/python/docs/api/class-playwright)
- [æ¸¬è©¦æœ€ä½³å¯¦è¸](https://playwright.dev/python/docs/best-practices)

---

## è²¢ç»

æ­¡è¿æäº¤ Issue å’Œ Pull Requestï¼

## æˆæ¬Š

MIT License
